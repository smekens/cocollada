/* Author  : Jerome ODIER, Christophe SMEKENS, Francois SMEKENS
 * Email   : ---@gmail.com, ---@gmail.com, ---@gmail.com
 *
 * Version : 1.0 (2010-2011)
 *
 *
 * This file is part of CLDA.
 *
 */

/*-------------------------------------------------------------------------*/

#include <stdio.h>

#include "../../include/collada.h"

/*-------------------------------------------------------------------------*/

int main(int argc, char **argv)
{
	if(argc != 2)
	{
		fprintf(stderr, "Usage: %s <fname>\n", argv[0]);

		return 1;
	}

	FILE *fp = fopen(argv[1], "rt");

	if(fp != NULL)
	{
		bool result = true;
		/*-----------------------------------------------------------------*/
		/* INITIALIZE COLLADA						   */
		/*-----------------------------------------------------------------*/

		collada_ctx_t ctx;

		collada_ctx_initialize(&ctx);

		/*-----------------------------------------------------------------*/
		/* LOAD								   */
		/*-----------------------------------------------------------------*/

		fseek(fp, 0, SEEK_END);
		size_t size = ftell(fp);
		fseek(fp, 0, SEEK_SET);

		/**/

		buff_t buff = ctnr_pool_malloc_zero(&ctx.pool, size + 1);

		fread(buff, 1, size, fp);

		fclose(fp);

		/*-----------------------------------------------------------------*/
		/* COLLADA PARSE						   */
		/*-----------------------------------------------------------------*/

		result = collada_ctx_loader(&ctx, buff, size);

		/*-----------------------------------------------------------------*/
		/* COLLADA DUMP							   */
		/*-----------------------------------------------------------------*/

		collada_ctx_check_all(&ctx);

		/*-----------------------------------------------------------------*/
		/* FINALIZE COLLADA						   */
		/*-----------------------------------------------------------------*/

		collada_ctx_finalize(&ctx);

		/*-----------------------------------------------------------------*/
		/* FINALIZE							   */
		/*-----------------------------------------------------------------*/

		return result != false ? 0 : 1;
	}

	return 1;
}

/*-------------------------------------------------------------------------*/

